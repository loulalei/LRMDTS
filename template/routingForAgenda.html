{{template "header" .}}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.8-beta.17/jquery.inputmask.min.js"
integrity="sha512-zdfH1XdRONkxXKLQxCI2Ak3c9wNymTiPh5cU4OsUavFDATDbUzLR+SYWWz0RkhDmBDT0gNSUe4xrQXx8D89JIQ=="
crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<input type="text" id="baseURL" value="{{.baseURL}}" readonly hidden>
<nav class="navbar navbar-expand-sm bg-body-tertiary">
    <div class="container-fluid">
        <a class="navbar-brand" href="/api/routing"><i class="bi bi-calendar-week"></i> FOR AGENDA</a>
    </div>
</nav>

<div class="container-fluid py-2 shadow mb-3">
    <form class="row" action="/api/routing/update_filing" method="post" enctype="multipart/form-data">
        <div class="col-md-2">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <div class="input-group-text">
                        <input type="checkbox" aria-label="Checkbox for following text input">
                        <label for="item_no">URGENT</label>
                    </div>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="item_no" placeholder="yyyy-0000" autocomplete="false">
                    <label for="item_no">Item Number</label>
                </div>
                <!-- <input type="text" class="form-control" id="item_no" aria-label="Text input with checkbox"
                    placeholder="Item No."> -->
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-floating mb-3">
                <input type="date" class="form-control" id="date_calendared">
                <label for="date_calendared">Date Calendared</label>
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-floating mb-3">
                <input type="date" class="form-control" id="date_reported" placeholder="name@example.com">
                <label for="date_reported">Date Reported</label>
            </div>
        </div>
        <div class="col-md-2">
            <div class="form-floating">
                <select class="form-select" id="source" name="source">
                    <option disabled>Select Source</option>
                    <option selected value="1">Other Department</option>
                    <option value="2">Priviledged Speech</option>
                    <option value="3">Proposed</option>
                </select>
                <label for="source">Source</label>
            </div>
        </div>
        <div class="col-md-4 src" id="cb_department">
            <div class="form-floating">
                <select class="form-select" id="department" name="department">
                    <option selected disabled>Select Department</option>
                    {{range .departments}}
                    <option value={{.Name}}>{{.Name}}</option>
                    {{end}}
                </select>
                <label for="department">Department</label>
            </div>
        </div>
        <div class="col-md-4 src" id="cb_proponent">
            <div class="form-floating">
                <select class="form-select" id="proponent" name="proponent">
                    <option selected disabled>Select Proponent</option>
                    {{range .proponents}}
                    <option value={{.Name}}>{{.Name}}</option>
                    {{end}}
                </select>
                </select>
                <label for="proponent">Proponent</label>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-floating">
                <select class="form-select" id="documentTag" name="documentTag" aria-label="Default select example">
                    <option selected disabled>Select Action</option>
                    <option value="1">For information of the whole body</option>
                    <option value="2">Referred to Committee</option>
                    <option value="3">Approved</option>
                </select>
                <label for="documentTag">Document Tag</label>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-floating mb-3">
                <input type="text" class="form-control" id="remarks" name="remarks" required readonly disabled>
                <label for="remarks">Remarks</label>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-floating">
                <select class="form-select" id="committees" name="committees">
                    <option selected disabled>Select Committee</option>
                    {{range .committees}}
                    <option value={{.Id}}>{{.Name}}</option>
                    {{end}}
                </select>
                <label for="committees">Document Tag</label>
            </div>

            <!-- <div class="form-floating mb-6">
                <div class="input-group mb-3">
                    <button id="add_committee" class="btn btn-success" type="button">ADD</button>
                    <select class="form-select" id="committees" name="committees">
                        <option selected disabled>Select Committee</option>
                        {{range .committees}}
                        <option value={{.Id}}>{{.Name}}</option>
                        {{end}}
                    </select>
                </div>
            </div> -->
        </div>
        <div class="col-md-1 py-1">
            <div class="d-grid gap-2">
                <button id="add_committee" class="btn btn-success btn-lg" type="button"><i
                        class="fa-solid fa-plus"></i></button>
            </div>
        </div>
        <hr>
        <div class="col-md-12">
            <table class="table table-striped table-hover border">
                <thead>
                    <tr>
                        <th colspan="2">COMMITTEE LIST</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- {{range .viewCommittees}}
                    <tr>
                        <td>{{.Name}}</td>
                        <td>
                            <div class="d-grid gap-3 mx-auto">
                                <button id="remove_committee" class="btn btn-danger btn-sm fw-bold" type="button">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {{end}} -->
                </tbody>
            </table>
        </div>



        <hr>
        <div class="col-md-12 mb-2">
            <small><a class="btn btn-success fw-bold btn-sm" href="/api/routing"><i class="fa-solid fa-floppy-disk"></i>
                    SAVE DOCUMENT</a></small>
        </div>
    </form>

</div>

<script>
    $(document).ready(function () {
        $("#cb_proponent").hide();
        $('#source').on('change', function () {
            var sourceValue = $(this).val();
            if (sourceValue == '1') {
                $("#cb_proponent").hide();
                $("#cb_department").show();
            } else if (sourceValue == '2') {
                $("#cb_proponent").show();
                $("#cb_department").hide();
            } else if (sourceValue == '3') {
                $("#cb_proponent").show();
                $("#cb_department").hide();
            }
        });
    });
</script>

<script>
    $(document).ready(function () {
        $("#documentTag").click(function () {
            var selectedValue = document.getElementById("documentTag").value
            if (selectedValue == "1") {
                document.getElementById("remarks").value = "Forwarded to Records";
            } else if (selectedValue == "2") {
                document.getElementById("remarks").value = "Kept in Secretariat";
            }
            else if (selectedValue == "3") {
                document.getElementById("remarks").value = "Forwarded to Records";
            }
        });

        $("#item_no").inputmask("9999-9999");
    });
</script>

<script>
    $(document).ready(function () {
        $("#add_committee").click(function () {
            var committeeId = $('#committees').find(":selected").val();
            var committeeName = $('#committees').find(":selected").text();
            var itemNumber = $('#item_no').val();
            var userId = $('#userId').val();
            var baseURL = $('#baseURL').val();
            var endpoint = baseURL + "/api/routing/add_committee"

            if (itemNumber == "") {
                Swal.fire(
                    'Adding Error',
                    'Item number is empty',
                    'info'
                )
            } else {

                $.post(endpoint,
                    {
                        itemNumber: itemNumber,
                        committeeId: committeeId,
                        userId: userId
                    },
                    function (response, status) {
                        if (response.status == 100) {
                            // alert("Response:"+response.request['listId'])
                            // alert("data: " + response.data[0].listId + "\nstatus: " + status);
                            var markup =
                                `<tr>
                                <td>` + response.data['name'] + `</td>
                                <td>
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <button id="remove_committee" name="remove_committee" class="btn btn-danger btn-sm fw-bold" type="button">
                                            <i class="fa-solid fa-trash" id="remove_committee"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>`;
                            $("table tbody").append(markup);
                            const Toast = Swal.mixin({
                                toast: true,
                                position: "top-end",
                                showConfirmButton: false,
                                timer: 2000,
                                timerProgressBar: true,
                            });
                            Toast.fire({
                                icon: "success",
                                title: response.message,
                            });
                        } else {
                            const Toast = Swal.mixin({
                                toast: true,
                                position: "top-end",
                                showConfirmButton: false,
                                timer: 2000,
                                timerProgressBar: true,
                            });
                            Toast.fire({
                                icon: "error",
                                title: response.message,
                            });
                        }

                    });
            }
        });

        $("#remove_committee").click(function () {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 2000,
                timerProgressBar: true,
            });
            Toast.fire({
                icon: "success",
                title: "Testing response",
            });
        });

    });

</script>